---
- name: Set archive source for Joomla 3
  set_fact:
    archive_source: "{{ archive_source_j3 }}"
  when: j_master_version == '3'

- name: Set archive source for Joomla 4
  set_fact:
    archive_source: "{{ archive_source_j4 }}"
  when: j_master_version == '4'

- name: Debug Joomla master version
  debug:
    msg: "{{ j_master_version }}"

- name: Debug archive source
  debug:
    msg: "{{ archive_source }}"

- name: unpack Joomla files to document root
  unarchive:
    src: "{{ archive_source }}"
    dest: "{{ tester_web_root }}"
    remote_src: yes
    group: "{{ tester_www_user }}"
    owner: "{{ tester_www_group }}"

- name: get Joomla SQL files to fill into database
  fetch:
    src: "{{ tester_web_root }}installation/sql/mysql/{{ item }}"
    dest: "../files/joomla/{{ item }}"
    flat: yes
  with_items:
    - "joomla.sql"
    - "sample_learn.sql"

- name: remove Joomla installation folder
  file:
    path: "{{ tester_web_root }}installation/"
    state: absent
