---
- name: Debug Joomla master version
  debug:
    msg: "{{ j_master_version }}"

- name: Debug archive source
  debug:
    msg: "{{ bw_artifacts_base }}/data/j_install"

- name: unpack Joomla files to document root
  unarchive:
    src: "{{ bw_artifacts_base }}/data/j_install/{{ j_package_name[j_version_short] }}"
    dest: "{{ tester_web_root }}"
    group: "{{ tester_www_user }}"
    owner: "{{ tester_www_group }}"
#    remote_src: yes

- name: get Joomla SQL files to fill into database
  fetch:
    src: "{{ tester_web_root }}installation/sql/mysql/{{ item.name }}"
    dest: "files/joomla/{{ item.name }}"
    flat: yes
  with_items:
    - { name: base.sql, is_j4: "{{ j_master_version == '4' }}" }
    - { name: supports.sql, is_j4: "{{ j_master_version == '4' }}" }
    - { name: extensions.sql, is_j4: "{{ j_master_version == '4' }}" }
    - { name: joomla.sql, is_j3: "{{ j_master_version == '3' }}" }
    - { name: sample_learn.sql, is_j3: "{{ j_master_version == '3' }}" }
  when: item.is_j3 | default(True) | bool
  ignore_errors: yes

- name: remove Joomla installation folder
  file:
    path: "{{ tester_web_root }}installation/"
    state: absent
