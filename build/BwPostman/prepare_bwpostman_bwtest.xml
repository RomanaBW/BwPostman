<?xml version="1.0" encoding="UTF-8"?>

<project name="BwPostman Prepare BwTest"  description="Copy BwPostman files to BwTest" default="prepare_bwtest">
	<import file="./bwpostman_variables.xml"/>

	<!-- ============================================  -->
	<!-- Target: prepare                               -->
	<!-- (Setting variables, delete target directory,  -->
	<!--  create target directory)                     -->
	<!-- ============================================  -->
	<target name="set_further_variables" depends="set_variables">
		<echo msg="Set variables…" />
		<property name="override" value="false" override="true" />

		<property name="target_base_dir" value="/vhosts/bwtest" override="true" />
		<property name="extension_lowercase" value="bwpostman" override="true" />


		<property name="module1" value="mod_bwpostman" override="true" />
		<property name="module2" value="mod_bwpostman_overview" override="true" />

		<property name="plugin1" value="personalize" override="true" />

		<echo msg="Source dirs…" />
		<property name="component_admin_dir" value="/administrator/components/${component}" override="true" />
		<property name="component_site_dir" value="/components/${component}" override="true" />

		<property name="module1_dir" value="/modules/${module1}" override="true" />
		<property name="module2_dir" value="/modules/${module2}" override="true" />

		<property name="plugin1_dir" value="/plugins/bwpostman/${plugin1}" override="true" />

		<property name="media_dir" value="/media/bw_postman" override="true" />

		<property name="lang_admin_de_dir" value="/administrator/language/de-DE" override="true" />
		<property name="lang_admin_en_dir" value="/administrator/language/en-GB" override="true" />
		<property name="lang_site_de_dir" value="/language/de-DE" override="true" />
		<property name="lang_site_en_dir" value="/language/en-GB" override="true" />
	</target>

	<!-- ============================================  -->
	<!-- Target: prepare_bwtest                        -->
	<!-- (copy all files of BwPostman to bwtest        -->
	<!--  directory                                    -->
	<!-- ============================================  -->
	<target name="prepare_bwtest" depends="set_further_variables">
		<echo msg="Chmod target dir…" />
		<chown user="romana.users">
			<fileset dir="${target_base_dir}">
				<include name="${component_admin_dir}**" />
				<include name="${component_site_dir}**" />
				<include name="${module1_dir}**" />
				<include name="${module2_dir}**" />
				<include name="${plugin1_dir}**" />
				<include name="${media_dir}**" />
				<include name="${lang_admin_de_dir}**" />
				<include name="${lang_admin_en_dir}**" />
				<include name="${lang_site_de_dir}**" />
				<include name="${lang_site_en_dir}**" />
			</fileset>
		</chown>
		<chmod mode="0777">
			<fileset dir="${target_base_dir}">
				<include name="${component_admin_dir}**" />
				<include name="${component_site_dir}**" />
				<include name="${module1_dir}**" />
				<include name="${module2_dir}**" />
				<include name="${plugin1_dir}**" />
				<include name="${media_dir}**" />
				<include name="${lang_admin_de_dir}**" />
				<include name="${lang_admin_en_dir}**" />
				<include name="${lang_site_de_dir}**" />
				<include name="${lang_site_en_dir}**" />
			</fileset>
		</chmod>

		<echo msg="Copying files to bwtest directory…" />

		<echo msg="Copying component admin…" />
		<copy todir="${target_base_dir}${component_admin_dir}" overwrite="${override}">
			<fileset dir="${source_base_dir}${component_admin_dir}">
				<include name="**" />
			</fileset>
		</copy>

		<echo msg="Copying component site…" />
		<copy todir="${target_base_dir}${component_site_dir}" overwrite="${override}">
			<fileset dir="${source_base_dir}${component_site_dir}">
				<include name="**" />
			</fileset>
		</copy>

		<echo msg="Copying module 1…" />
		<copy todir="${target_base_dir}${module1_dir}" overwrite="${override}">
			<fileset dir="${source_base_dir}${module1_dir}">
				<include name="**" />
			</fileset>
		</copy>

		<echo msg="Copying module 2…" />
		<copy todir="${target_base_dir}${module2_dir}" overwrite="${override}">
			<fileset dir="${source_base_dir}${module2_dir}">
				<include name="**" />
			</fileset>
		</copy>

		<echo msg="Copying plugin 1…" />
		<copy todir="${target_base_dir}${plugin1_dir}" overwrite="${override}">
			<fileset dir="${source_base_dir}${plugin1_dir}">
				<include name="**" />
			</fileset>
		</copy>

		<echo msg="Copying media…" />
		<copy todir="${target_base_dir}${media_dir}" overwrite="${override}">
			<fileset dir="${source_base_dir}${media_dir}">
				<include name="**" />
			</fileset>
		</copy>

		<echo msg="Copying admin language files…" />
		<copy todir="${target_base_dir}${lang_admin_de_dir}" overwrite="${override}">
			<fileset dir="${source_base_dir}${lang_admin_de_dir}">
				<include name="**/*${extension_lowercase}*.ini" />
			</fileset>
		</copy>
		<copy todir="${target_base_dir}${lang_admin_en_dir}" overwrite="${override}">
			<fileset dir="${source_base_dir}${lang_admin_en_dir}">
				<include name="**/*${extension_lowercase}*.ini" />
			</fileset>
		</copy>

		<echo msg="Copying site language files…" />
		<copy todir="${target_base_dir}${lang_site_de_dir}" overwrite="${override}">
			<fileset dir="${source_base_dir}${lang_site_de_dir}">
				<include name="**/*${extension_lowercase}*.ini" />
			</fileset>
		</copy>
		<copy todir="${target_base_dir}${lang_site_en_dir}" overwrite="${override}">
			<fileset dir="${source_base_dir}${lang_site_en_dir}">
				<include name="**/*${extension_lowercase}*.ini" />
			</fileset>
		</copy>

		<echo msg="Chmod target dir…" />
		<chmod file="${target_base_dir}" mode="0777" />
	</target>

</project>
