---
- hosts: workplace
  gather_facts: no
  vars_files:
    - vars/fast-test-vars.yml

  tasks:
    # Synchronize var files to repo before used by following playbook and tasks
    - name: Synchronize needed vars files to repo
      become: yes
      synchronize:
        src: "{{ test_project_base_dir }}/build/playbooks/"
        dest: "{{ repo_dir }}/build/playbooks"
        archive: yes
        partial: yes
        mode: pull
        rsync_opts:
          - "--update"
          - "--quiet"

- hosts: tester
  gather_facts: no

- import_playbook: create-push-apache-image.yml
- import_playbook: create-push-mariadb-image.yml
  when: update_database is defined
- import_playbook: create-push-joomla-files-image.yml
- import_playbook: create-push-joomla-tables-image.yml
- import_playbook: install-required-extensions-push.yml
#- import_playbook: install-virtuemart-push.yml
